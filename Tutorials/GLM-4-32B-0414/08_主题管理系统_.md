# Chapter 8: ä¸»é¢˜ç®¡ç†ç³»ç»Ÿ

æ¬¢è¿æ¥åˆ°æˆ‘ä»¬çš„æ–°ç« èŠ‚ï¼åœ¨ä¸Šä¸€ç« æˆ‘ä»¬å­¦ä¼šäº†ç”¨[è§†å›¾å®šä½å™¨](07_è§†å›¾å®šä½å™¨_.md)è‡ªåŠ¨åŒ¹é…è§†å›¾å’ŒViewModelåï¼Œä»Šå¤©è®©æˆ‘ä»¬ä¸€èµ·æ¢ç´¢å¦‚ä½•åƒå˜è‰²é¾™ä¸€æ ·éšå¿ƒå˜æ¢åº”ç”¨å¤–è§‚â€”â€”è¿™å°±æ˜¯å¼ºå¤§çš„ä¸»é¢˜ç®¡ç†ç³»ç»Ÿï¼

## ä¸ºä»€ä¹ˆè¦ç®¡ç†ä¸»é¢˜ï¼Ÿ

æƒ³è±¡ä½ çš„æ‰‹æœºæœ‰æ·±è‰²å’Œæµ…è‰²æ¨¡å¼ï¼š
- ğŸŒ™ æ™šä¸Šç”¨æ·±è‰²æ¨¡å¼ä¿æŠ¤çœ¼ç›
- â˜€ï¸ ç™½å¤©ç”¨æµ…è‰²æ¨¡å¼æ¸…æ™°å¯è§
- ğŸ¨ è¿˜å¯ä»¥è‡ªå®šä¹‰å–œæ¬¢çš„é…è‰²æ–¹æ¡ˆ

ä¸»é¢˜ç®¡ç†ç³»ç»Ÿå°±æ˜¯åº”ç”¨ç•Œçš„**æ—¶å°šè®¾è®¡å¸ˆ**ï¼Œå®ƒèƒ½è®©ä½ ï¼š
- ğŸ­ ä¸€é”®åˆ‡æ¢åº”ç”¨æ•´ä½“è§†è§‰é£æ ¼
- ğŸ–Œï¸ ç»Ÿä¸€ç®¡ç†æ‰€æœ‰ç•Œé¢å…ƒç´ æ ·å¼
- ğŸ§¥ æ‰“é€ ä¸“å±äºä½ çš„ç‹¬ç‰¹å¤–è§‚

```mermaid
pie
    title ä¸»é¢˜ç®¡ç†çš„ä»·å€¼
    "è§†è§‰ä¸€è‡´æ€§" : 40
    "ç”¨æˆ·ä½“éªŒ" : 30
    "ç»´æŠ¤æ•ˆç‡" : 30
```

## ä¸»é¢˜ç³»ç»Ÿä¸‰å¤§æ³•å®

### 1. ä¸»é¢˜é…ç½® (App.axaml)

è¿™æ˜¯å®šä¹‰åŸºç¡€ä¸»é¢˜çš„"è°ƒè‰²ç›˜"ï¼š

```xml
<Application.Styles>
    <FluentTheme Mode="Dark"/> <!-- é»˜è®¤ä½¿ç”¨æ·±è‰²ä¸»é¢˜ -->
</Application.Styles>
```

å…³é”®å‚æ•°ï¼š
- `FluentTheme`ï¼šä½¿ç”¨Fluentè®¾è®¡é£æ ¼
- `Mode`ï¼šå¯é€‰`Dark`/`Light`/`Default`(è·Ÿéšç³»ç»Ÿ)

### 2. åŠ¨æ€åˆ‡æ¢ (ThemeService.cs)

æ¥çœ‹çœ‹"æ—¶å°šè®¾è®¡å¸ˆ"å¦‚ä½•æ¢è£…ï¼š

```csharp
public class ThemeService
{
    private readonly IServiceProvider _serviceProvider;
    
    public ThemeService(IServiceProvider serviceProvider)
    {
        _serviceProvider = serviceProvider;
    }

    public void SwitchTheme(ThemeMode mode)
    {
        var app = _serviceProvider.GetRequiredService<Application>();
        app.RequestedThemeVariant = mode == ThemeMode.Dark 
            ? ThemeVariant.Dark 
            : ThemeVariant.Light; // åˆ‡æ¢ä¸»é¢˜å˜ä½“
    }
}
```

å¯é€‰çš„`ThemeMode`æšä¸¾ï¼š
```csharp
public enum ThemeMode { Light, Dark }
```

### 3. ä¸»é¢˜åˆ‡æ¢æŒ‰é’® (MainWindow.axaml)

ç»™ç”¨æˆ·ä¸€ä¸ª"æ¢è£…æŒ‰é’®"ï¼š

```xml
<Button Command="{Binding SwitchThemeCommand}" 
        Content="åˆ‡æ¢ä¸»é¢˜" 
        HorizontalAlignment="Right"/>
```

å¯¹åº”çš„ViewModelå‘½ä»¤ï¼š
```csharp
[RelayCommand]
private void SwitchTheme()
{
    _themeService.SwitchTheme(ThemeMode.Dark); // è°ƒç”¨ä¸»é¢˜æœåŠ¡
}
```

## å†…éƒ¨æ¢è£…æµç¨‹

ä¸»é¢˜åˆ‡æ¢å°±åƒèˆå°ç¯å…‰æ§åˆ¶ï¼š

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant V as è§†å›¾æŒ‰é’®
    participant VM as ViewModel
    participant TS as ä¸»é¢˜æœåŠ¡
    participant A as åº”ç”¨ç¨‹åº
    
    U->>V: ç‚¹å‡»åˆ‡æ¢æŒ‰é’®
    V->>VM: è§¦å‘SwitchThemeCommand
    VM->>TS: è°ƒç”¨SwitchTheme()
    TS->>A: ä¿®æ”¹RequestedThemeVariant
    A->>æ‰€æœ‰è§†å›¾: è‡ªåŠ¨æ›´æ–°æ ·å¼
```

## å®é™…åº”ç”¨ç¤ºä¾‹

å®Œæ•´å®ç°ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½ï¼š

1. æ³¨å†Œä¸»é¢˜æœåŠ¡ï¼š
```csharp
// Program.cs
services.AddSingleton<ThemeService>();
```

2. æ³¨å…¥ä½¿ç”¨ï¼š
```csharp
public MainWindowViewModel(ThemeService themeService)
{
    _themeService = themeService;
}
```

3. å¢å¼ºç‰ˆåˆ‡æ¢é€»è¾‘ï¼š
```csharp
public void SwitchTheme()
{
    var current = Application.Current.RequestedThemeVariant;
    var newTheme = current == ThemeVariant.Dark 
        ? ThemeMode.Light 
        : ThemeMode.Dark; // è‡ªåŠ¨åè½¬å½“å‰ä¸»é¢˜
    _themeService.SwitchTheme(newTheme);
}
```

## å¸¸è§é—®é¢˜è§£ç­”

â“ ä¸ºä»€ä¹ˆä¸»é¢˜åˆ‡æ¢æ— æ•ˆï¼Ÿ
æ£€æŸ¥ï¼š
1. æ˜¯å¦æ­£ç¡®è°ƒç”¨äº†`RequestedThemeVariant`
2. æ‰€æœ‰æ ·å¼æ˜¯å¦ä½¿ç”¨äº†ä¸»é¢˜æ„ŸçŸ¥çš„é¢œè‰²
3. æ˜¯å¦åœ¨æ­£ç¡®çš„ä½œç”¨åŸŸä¿®æ”¹ä¸»é¢˜

â“ å¦‚ä½•æ·»åŠ è‡ªå®šä¹‰ä¸»é¢˜ï¼Ÿ
å¯ä»¥ç»§æ‰¿`FluentTheme`å¹¶é‡å†™èµ„æºå­—å…¸ï¼Œæˆ–è€…åˆ›å»ºå®Œæ•´çš„æ–°`Styles`é›†åˆ

## æ€»ç»“ä¸ç»ƒä¹ 

ä»Šå¤©æˆ‘ä»¬å­¦ä¼šäº†ï¼š
- ä¸»é¢˜ç®¡ç†çš„åŸºæœ¬åŸç†
- åŠ¨æ€åˆ‡æ¢ä¸»é¢˜çš„å®ç°æ–¹æ³•
- ä¸»é¢˜æœåŠ¡ä¸ç•Œé¢äº¤äº’çš„æ–¹å¼

åŠ¨æ‰‹æŒ‘æˆ˜ï¼š
1. æ·»åŠ "è·Ÿéšç³»ç»Ÿ"ä¸»é¢˜é€‰é¡¹
2. å®ç°ä¸‰ä¸ªä¸»é¢˜åˆ‡æ¢æŒ‰é’®(äº®/æš—/ç³»ç»Ÿ)

ä¸‹èŠ‚è¯¾æˆ‘ä»¬å°†ç»§ç»­æ·±å…¥Avaloniaçš„ç²¾å½©ä¸–ç•Œï¼

---

Generated by [AI Codebase Knowledge Builder](https://github.com/The-Pocket/Tutorial-Codebase-Knowledge)