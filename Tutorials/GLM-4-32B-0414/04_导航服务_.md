# Chapter 4: å¯¼èˆªæœåŠ¡

æ¬¢è¿å›æ¥ï¼åœ¨ä¸Šä¸€ç« æˆ‘ä»¬å­¦ä¹ äº†[ä¾èµ–æ³¨å…¥ç³»ç»Ÿ](03_ä¾èµ–æ³¨å…¥ç³»ç»Ÿ_.md)ï¼Œç°åœ¨è®©æˆ‘ä»¬ä¸€èµ·æ¢ç´¢å¦‚ä½•åƒåœ°é“æ¢ä¹˜ä¸€æ ·è½»æ¾åˆ‡æ¢é¡µé¢â€”â€”è¿™å°±æ˜¯ç¥å¥‡çš„å¯¼èˆªæœåŠ¡ï¼

## ä¸ºä»€ä¹ˆéœ€è¦å¯¼èˆªæœåŠ¡ï¼Ÿ

æƒ³è±¡ä½ å»å›¾ä¹¦é¦†å€Ÿä¹¦ï¼š
1. ğŸ“š ä½ æƒ³ä»"ç§‘å¹»åŒº"å»"å†å²åŒº"
2. ğŸƒâ€ ä¸æƒ³è‡ªå·±è·‘æ¥è·‘å»æ¬ä¹¦ï¼ˆæ‰‹åŠ¨åˆ›å»º/é”€æ¯é¡µé¢ï¼‰
3. ğŸ§™â€â™‚ï¸ å¸Œæœ›æœ‰é­”æ³•è‡ªåŠ¨å®Œæˆä¹¦æ¶åˆ‡æ¢

å¯¼èˆªæœåŠ¡å°±æ˜¯è¿™æ ·çš„**å›¾ä¹¦é¦†å‘å¯¼ç²¾çµ**ï¼š
- ğŸšª è‡ªåŠ¨æ‰“å¼€ç›®æ ‡é¡µé¢
- ğŸ”„ ä¼˜é›…å…³é—­å½“å‰é¡µé¢
- ğŸ—ºï¸ ç®¡ç†æ‰€æœ‰é¡µé¢çŠ¶æ€

## æ ¸å¿ƒç»„ä»¶ä¸‰æ˜æ²»

å¯¼èˆªæœåŠ¡ä¸»è¦ç”±ä¸‰å±‚ç»„æˆï¼š

```mermaid
pie
    title å¯¼èˆªæœåŠ¡ç»„æˆ
    "æ¥å£å®šä¹‰" : 30
    "å®ç°ç±»" : 50
    "è§†å›¾æ¨¡å‹ç»‘å®š" : 20
```

### 1. å¯¼èˆªæ¥å£ (INavigationService.cs)

è¿™æ˜¯å¯¼èˆªæœåŠ¡çš„"ä½¿ç”¨è¯´æ˜ä¹¦"ï¼š

```csharp
public interface INavigationService
{
    ViewModelBase CurrentViewModel { get; }  // å½“å‰æ˜¾ç¤ºçš„é¡µé¢
    void NavigateTo<T>() where T : ViewModelBase; // è·³è½¬åˆ°æŒ‡å®šé¡µé¢
}
```

å…³é”®åŠŸèƒ½ï¼š
- `CurrentViewModel`ï¼šè·å–å½“å‰å±•ç¤ºçš„é¡µé¢
- `NavigateTo<T>`ï¼šè·³è½¬åˆ°ç›®æ ‡é¡µé¢ç±»å‹

### 2. æœåŠ¡å®ç° (NavigationService.cs)

çœ‹çœ‹å‘å¯¼ç²¾çµå¦‚ä½•æ–½å±•é­”æ³•ï¼š

```csharp
public partial class NavigationService : ObservableObject, INavigationService
{
    [ObservableProperty]
    private ViewModelBase _currentViewModel; // å½“å‰é¡µé¢(è‡ªåŠ¨ç”Ÿæˆå±æ€§)

    private readonly IServiceProvider _serviceProvider; // ä¾èµ–æ³¨å…¥å®¹å™¨

    public NavigationService(IServiceProvider serviceProvider)
    {
        _serviceProvider = serviceProvider;
        NavigateTo<Page1ViewModel>(); // é»˜è®¤æ˜¾ç¤ºé¦–é¡µ
    }

    public void NavigateTo<T>() where T : ViewModelBase
    {
        // ä»å®¹å™¨è·å–æ–°é¡µé¢å®ä¾‹
        var viewModel = _serviceProvider.GetRequiredService<T>();
        CurrentViewModel = viewModel; // æ›´æ–°å½“å‰é¡µé¢
    }
}
```

å¯¼èˆªæ­¥éª¤è§£æï¼š
1. ğŸ§° ä½¿ç”¨ä¾èµ–æ³¨å…¥å®¹å™¨è·å–æ–°é¡µé¢
2. ğŸ”„ æ›´æ–°`CurrentViewModel`å±æ€§
3. ğŸ‰ ç•Œé¢è‡ªåŠ¨åˆ·æ–°æ˜¾ç¤ºæ–°é¡µé¢

### 3. ä¸»çª—å£ç»‘å®š (MainWindowViewModel.cs)

çœ‹çœ‹é¡µé¢åˆ‡æ¢å¦‚ä½•ä¸UIè”åŠ¨ï¼š

```csharp
public partial class MainWindowViewModel : ViewModelBase
{
    private readonly INavigationService _navigationService;
    
    [ObservableProperty]
    private ViewModelBase currentPage; // ç»‘å®šåˆ°ç•Œé¢ContentControl

    public MainWindowViewModel(INavigationService navigationService)
    {
        _navigationService = navigationService;
        currentPage = _navigationService.CurrentViewModel;
        
        // ç›‘å¬å¯¼èˆªæœåŠ¡çš„é¡µé¢å˜åŒ–
        ((NavigationService)_navigationService).PropertyChanged += (_, args) =>
        {
            if (args.PropertyName == nameof(INavigationService.CurrentViewModel))
            {
                currentPage = _navigationService.CurrentViewModel;
            }
        };
    }
}
```

## å·¥ä½œåŸç†å›¾è§£

å¯¼èˆªæœåŠ¡çš„è¿è¡Œæµç¨‹å°±åƒåœ°é“è°ƒåº¦ï¼š

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant V as è§†å›¾æŒ‰é’®
    participant NS as å¯¼èˆªæœåŠ¡
    participant VM as ç›®æ ‡é¡µé¢
    
    U->>V: ç‚¹å‡»å¯¼èˆªæŒ‰é’®
    V->>NS: è°ƒç”¨NavigateTo<T>()
    NS->>VM: åˆ›å»ºæ–°é¡µé¢å®ä¾‹
    NS->>V: æ›´æ–°CurrentViewModel
    V->>U: æ˜¾ç¤ºæ–°é¡µé¢å†…å®¹
```

## å®é™…åº”ç”¨ç¤ºä¾‹

æ·»åŠ ä¸¤ä¸ªå¯¼èˆªæŒ‰é’®çš„å®Œæ•´ç¤ºä¾‹ï¼š

```xml
<!-- MainWindow.axaml -->
<StackPanel>
    <Button Command="{Binding NavigateToPage1Command}" Content="é¦–é¡µ"/>
    <Button Command="{Binding NavigateToPage2Command}" Content="è®¾ç½®"/>
</StackPanel>
```

å¯¹åº”ViewModelä¸­çš„å‘½ä»¤ï¼š

```csharp
[RelayCommand]
private void NavigateToPage1()
{
    _navigationService.NavigateTo<Page1ViewModel>();
}

[RelayCommand]
private void NavigateToPage2()
{
    _navigationService.NavigateTo<Page2ViewModel>();
}
```

## å¸¸è§é—®é¢˜è§£ç­”

â“ ä¸ºä»€ä¹ˆé¡µé¢åˆ‡æ¢åæŒ‰é’®çŠ¶æ€ä¸å˜ï¼Ÿ
è¿™æ˜¯æ­£å¸¸ç°è±¡ï¼Œå¯¼èˆªæœåŠ¡åªè´Ÿè´£é¡µé¢å†…å®¹åˆ‡æ¢ï¼Œèœå•çŠ¶æ€éœ€è¦å•ç‹¬ç®¡ç†

â“ å¦‚ä½•ä¼ é€’å‚æ•°ç»™ç›®æ ‡é¡µé¢ï¼Ÿ
å¯ä»¥åœ¨`NavigateTo`æ–¹æ³•ä¸­æ·»åŠ å‚æ•°ï¼Œå¹¶åœ¨ç›®æ ‡ViewModelä¸­æ¥æ”¶

## æ€»ç»“ä¸ç»ƒä¹ 

ä»Šå¤©æˆ‘ä»¬å­¦ä¼šäº†ï¼š
- å¯¼èˆªæœåŠ¡å¦‚ä½•å®ç°é¡µé¢åˆ‡æ¢
- CurrentViewModelçš„æ ¸å¿ƒä½œç”¨
- å¯¼èˆªå‘½ä»¤ä¸æŒ‰é’®çš„ç»‘å®šæ–¹æ³•

åŠ¨æ‰‹å°è¯•ï¼š
1. æ·»åŠ ç¬¬ä¸‰ä¸ªå¯¼èˆªæŒ‰é’®è·³è½¬åˆ°æ–°é¡µé¢
2. ä¿®æ”¹é»˜è®¤æ˜¾ç¤ºé¡µé¢ä¸ºPage2

ä¸‹èŠ‚è¯¾æˆ‘ä»¬å°†å­¦ä¹ [é¡µé¢è§†å›¾æ¨¡å‹](05_é¡µé¢è§†å›¾æ¨¡å‹_.md)ï¼Œäº†è§£å¦‚ä½•æ„å»ºå…·ä½“çš„é¡µé¢é€»è¾‘ï¼

---

Generated by [AI Codebase Knowledge Builder](https://github.com/The-Pocket/Tutorial-Codebase-Knowledge)