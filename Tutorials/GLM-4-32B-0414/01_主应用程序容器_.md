# Chapter 1: ä¸»åº”ç”¨ç¨‹åºå®¹å™¨


## ä¸ºä»€ä¹ˆéœ€è¦æ€»æ§åˆ¶å°ï¼Ÿ

æƒ³è±¡ä½ è¦å¼€åŠä¸€å®¶é¤å…ï¼š
1. éœ€è¦é‡‡è´­é£Ÿæï¼ˆåˆå§‹åŒ–èµ„æºï¼‰
2. å®‰æ’å¨å¸ˆå’ŒæœåŠ¡å‘˜ï¼ˆå¯åŠ¨æœåŠ¡ï¼‰
3. ç¡®ä¿æ¯å¤©æ­£å¸¸è¥ä¸šï¼ˆç»´æŠ¤ç”Ÿå‘½å‘¨æœŸï¼‰

åœ¨Avaloniaåº”ç”¨ä¸­ï¼Œ"ä¸»åº”ç”¨ç¨‹åºå®¹å™¨"å°±æ˜¯è¿™æ ·ä¸€ä¸ª**é¤å…æ€»ç®¡**è§’è‰²ï¼Œå®ƒè´Ÿè´£ï¼š

- âœ… å¯åŠ¨åº”ç”¨ç¨‹åº
- âœ… ç®¡ç†æ‰€æœ‰æ ¸å¿ƒç»„ä»¶
- âœ… å¤„ç†é€€å‡ºæ¸…ç†

## æ ¸å¿ƒé›¶ä»¶ç®±

ä¸»å®¹å™¨ä¸»è¦ç”±ä¸‰ä¸ªå…³é”®æ–‡ä»¶ç»„æˆï¼š

```mermaid
pie
    title ä¸»åº”ç”¨ç¨‹åºå®¹å™¨ç»„æˆ
    "Program.cs" : 45
    "App.axaml" : 30
    "App.axaml.cs" : 25
```

## 1. ç¨‹åºå¯åŠ¨å™¨ (Program.cs)

è¿™æ˜¯æ•´ä¸ªåº”ç”¨çš„"ç”µæºå¼€å…³"ï¼š

```csharp
public static void Main(string[] args)
{
    // åˆ›å»ºä¸€ä¸ªæœåŠ¡é›†åˆï¼ˆå°±åƒå‡†å¤‡å·¥å…·åŒ…ï¼‰
    var services = new ServiceCollection();
    
    // æ³¨å†Œå„ç§æœåŠ¡ï¼ˆæ”¾å…¥å·¥å…·åŒ…ï¼‰
    services.AddViews().AddViewModels().AddServices();
    
    // å®Œæˆå·¥å…·åŒ…è£…é…
    ServiceProvider = services.BuildServiceProvider();
    
    // å¯åŠ¨Avaloniaåº”ç”¨
    BuildAvaloniaApp().StartWithClassicDesktopLifetime(args);
}
```

â–º å·¥ä½œåŸç†å°±åƒç»„è£…ç©å…·ï¼š
1. å‡†å¤‡ç©ºç®±å­ï¼ˆ`ServiceCollection`ï¼‰
2. æ”¾å…¥é›¶ä»¶ï¼ˆæœåŠ¡æ³¨å†Œï¼‰
3. å°ç®±æ‰“åŒ…ï¼ˆ`BuildServiceProvider`ï¼‰
4. æŒ‰ä¸‹å¯åŠ¨æŒ‰é’®ï¼ˆ`StartWithClassicDesktopLifetime`ï¼‰

## 2. åº”ç”¨é…ç½®æ–‡ä»¶ (App.axaml)

è¿™æ˜¯åº”ç”¨çš„"è£…é¥°è“å›¾"ï¼š

```xml
<Application xmlns="https://github.com/avaloniaui">
    <!-- æŒ‡å®šè§†å›¾å®šä½å™¨ï¼ˆè‡ªåŠ¨åŒ¹é…è§†å›¾å’ŒViewModelï¼‰ -->
    <Application.DataTemplates>
        <local:ViewLocator/>
    </Application.DataTemplates>
  
    <!-- è®¾ç½®é»˜è®¤ä¸»é¢˜é£æ ¼ -->
    <Application.Styles>
        <FluentTheme />
    </Application.Styles>
</Application>
```

## 3. ç”Ÿå‘½å‘¨æœŸç®¡å®¶ (App.axaml.cs)

ç®¡ç†åº”ç”¨ç”Ÿå‘½å‘¨æœŸçš„å…³é”®é˜¶æ®µï¼š

```csharp
public override void OnFrameworkInitializationCompleted()
{
    if (ApplicationLifetime is IClassicDesktopStyleApplicationLifetime desktop)
    {
        // è·å–ä¸»çª—å£å’Œå®ƒçš„ViewModel
        var mainWindow = Program.ServiceProvider?.GetRequiredService<MainWindow>();
        var mainViewModel = Program.ServiceProvider?.GetRequiredService<MainWindowViewModel>();

        // ç»„è£…çª—å£å¹¶è®¾ç½®ä¸ºåº”ç”¨ä¸»çª—å£
        mainWindow.DataContext = mainViewModel;
        desktop.MainWindow = mainWindow;
    }
    base.OnFrameworkInitializationCompleted();
}
```

ğŸ”§ å†…éƒ¨å·¥ä½œæµç¨‹ï¼š

```mermaid
sequenceDiagram
    participant A as æ“ä½œç³»ç»Ÿ
    participant B as Program.cs
    participant C as App.axaml.cs
    participant D as ä¸»çª—å£
    
    A->>B: å¯åŠ¨ç¨‹åº
    B->>C: åˆå§‹åŒ–æ¡†æ¶
    C->>D: åˆ›å»ºä¸»çª—å£
    D-->>A: æ˜¾ç¤ºç•Œé¢
```

## å¸¸è§é—®é¢˜è§£ç­”

â“ ä¸ºä»€ä¹ˆè¦ç¦ç”¨æ•°æ®éªŒè¯æ’ä»¶ï¼Ÿ
```csharp
private void DisableAvaloniaDataAnnotationValidation()
{
    // ç§»é™¤å¯èƒ½å¯¼è‡´å†²çªçš„éªŒè¯æ’ä»¶
    var plugins = BindingPlugins.DataValidators.OfType<DataAnnotationsValidationPlugin>();
    foreach (var plugin in plugins) { BindingPlugins.DataValidators.Remove(plugin); }
}
```
å› ä¸ºæˆ‘ä»¬ä½¿ç”¨[ä¾èµ–æ³¨å…¥ç³»ç»Ÿ](03_ä¾èµ–æ³¨å…¥ç³»ç»Ÿ_.md)æ¥ç®¡ç†éªŒè¯é€»è¾‘ï¼Œé¿å…é‡å¤éªŒè¯ã€‚

## æ€»ç»“ä¸å®è·µ

ä»Šå¤©æˆ‘ä»¬å·²ç»å­¦ä¼šäº†ï¼š
- ä¸»å®¹å™¨æ˜¯åº”ç”¨çš„"ä¸­å¤®æ§åˆ¶ç³»ç»Ÿ"
- ä¸‰ä»¶æ ¸å¿ƒç»„ä»¶çš„åˆ†å·¥åä½œ
- åº”ç”¨çš„å¯åŠ¨ç”Ÿå‘½å‘¨æœŸç®¡ç†

è¯•ç€ä¿®æ”¹`Program.cs`ï¼š
```csharp
// åœ¨æœåŠ¡æ³¨å†Œå¤„æ·»åŠ ä½ çš„è‡ªå®šä¹‰æœåŠ¡
services.AddViews().AddViewModels().AddServices();
```

ä¸‹èŠ‚è¯¾æˆ‘ä»¬å°†å­¦ä¹ [ä¸»çª—å£æ¶æ„](02_ä¸»çª—å£æ¶æ„_.md)ï¼Œäº†è§£å¦‚ä½•æ„å»ºåº”ç”¨çš„ä¸»ç•Œé¢æ¡†æ¶ï¼

---

Generated by [AI Codebase Knowledge Builder](https://github.com/The-Pocket/Tutorial-Codebase-Knowledge)