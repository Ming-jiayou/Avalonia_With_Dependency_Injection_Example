# Chapter 6: å¯¼èˆªæœåŠ¡

åœ¨[ç¬¬äº”ç« ï¼šä¸»çª—å£è§†å›¾æ¨¡å‹](05_ä¸»çª—å£è§†å›¾æ¨¡å‹_.md)ä¸­ï¼Œæˆ‘ä»¬è§è¯†äº†ViewModelå¦‚ä½•åƒæ™ºèƒ½ç®¡å®¶ä¸€æ ·åè°ƒç•Œé¢äº¤äº’ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ›´ä¸“ä¸šçš„"å¯¼è§ˆå‘˜"â€”â€”**å¯¼èˆªæœåŠ¡**ï¼Œå®ƒç›¸å½“äºåº”ç”¨ç¨‹åºçš„GPSç³»ç»ŸğŸ§­ï¼Œä¸“é—¨è´Ÿè´£åœ¨ä¸åŒé¡µé¢é—´è§„åˆ’æœ€ä½³è·¯çº¿ã€‚

## ä¸ºä»€ä¹ˆéœ€è¦å¯¼èˆªæœåŠ¡ï¼Ÿ

æƒ³è±¡ä½ åœ¨æ¸¸ä¹å›­æ¸¸ç©ğŸ¢ï¼š
- **æ²¡æœ‰åœ°å›¾**ï¼šæ¯ä¸ªæ™¯ç‚¹éƒ½è¦é—®è·¯ï¼Œå®¹æ˜“è¿·è·¯ä¸”æ•ˆç‡ä½ä¸‹
- **æœ‰å¯¼è§ˆå›¾**ï¼šæ¸…æ™°æ ‡æ³¨æ‰€æœ‰è·¯çº¿ï¼Œéšæ—¶çŸ¥é“å½“å‰ä½ç½®å’Œå»å¤„

å¯¼èˆªæœåŠ¡æä¾›çš„æ ¸å¿ƒä»·å€¼ï¼š
1. ğŸ—ºï¸ ç»´æŠ¤é¡µé¢è·¯ç”±åœ°å›¾
2. ğŸ”„ ç®¡ç†å½“å‰æ˜¾ç¤ºçŠ¶æ€
3. ğŸšª æä¾›ç»Ÿä¸€çš„è·³è½¬æ¥å£

## æœ€ç®€å•çš„å¯¼èˆªç¤ºä¾‹

çœ‹çœ‹å¦‚ä½•ä½¿ç”¨å¯¼èˆªæœåŠ¡åˆ‡æ¢é¡µé¢ï¼š

```csharp
// åœ¨ViewModelä¸­æ³¨å…¥æœåŠ¡
private readonly INavigationService _navService;

// åƒä½¿ç”¨åœ°é“å¡ä¸€æ ·ç®€å•
[RelayCommand]
void GoToSettings()
{
    _navService.NavigateTo<SettingsViewModel>(); // è·³è½¬åˆ°è®¾ç½®é¡µ
}
```

è¿™æ®µä»£ç å°±åƒæŒ‰ä¸‹ç”µæ¢¯æŒ‰é’®ï¼š
- å‘Šè¯‰å¯¼èˆªæœåŠ¡ç›®çš„åœ°ï¼ˆ`SettingsViewModel`ï¼‰
- æœåŠ¡è‡ªåŠ¨å¤„ç†è·¯çº¿è§„åˆ’
- ç•Œé¢è‡ªåŠ¨æ›´æ–°æ˜¾ç¤º

## æœåŠ¡æ¥å£è§£æ

å¯¼èˆªæœåŠ¡çš„"è¯´æ˜ä¹¦"ï¼ˆæ¥å£å®šä¹‰ï¼‰ï¼š

```csharp
public interface INavigationService
{
    ViewModelBase CurrentViewModel { get; } // å½“å‰æ˜¾ç¤ºå“ªä¸ªé¡µé¢
    void NavigateTo<T>() where T : ViewModelBase; // è·³è½¬åˆ°æŒ‡å®šé¡µé¢
}
```

å…³é”®è®¾è®¡ï¼š
- `CurrentViewModel`ï¼šåƒGPSçš„å½“å‰ä½ç½®æ ‡è®°
- `NavigateTo`ï¼šåƒå¯¼èˆªç³»ç»Ÿçš„"å¼€å§‹å¯¼èˆª"æŒ‰é’®

## å·¥ä½œåŸç†å›¾è§£

```mermaid
sequenceDiagram
    participant ç”¨æˆ· as ç”¨æˆ·æ“ä½œ
    participant VM as ViewModel
    participant å¯¼èˆª as å¯¼èˆªæœåŠ¡
    participant DI as æœåŠ¡å®¹å™¨
    
    ç”¨æˆ·->>VM: ç‚¹å‡»"è·³è½¬"æŒ‰é’®
    VM->>å¯¼èˆª: è°ƒç”¨NavigateTo<Page2>()
    å¯¼èˆª->>DI: è¯·æ±‚Page2ViewModelå®ä¾‹
    DI-->>å¯¼èˆª: è¿”å›æ–°åˆ›å»ºçš„VM
    å¯¼èˆª->>å¯¼èˆª: æ›´æ–°CurrentViewModel
    å¯¼èˆª->>VM: è§¦å‘å±æ€§å˜æ›´é€šçŸ¥
    VM->>è§†å›¾: æ›´æ–°ç•Œé¢æ˜¾ç¤º
```

## å®é™…å®ç°æ­ç§˜

çœ‹çœ‹å¯¼èˆªæœåŠ¡çš„å†…éƒ¨æ„é€ ï¼š

```csharp
public partial class NavigationService : ObservableObject, INavigationService
{
    [ObservableProperty]
    private ViewModelBase _currentViewModel; // å½“å‰é¡µé¢çš„ViewModel

    private readonly IServiceProvider _serviceProvider; // ä¾èµ–æœåŠ¡å®¹å™¨

    public NavigationService(IServiceProvider provider)
    {
        _serviceProvider = provider;
        NavigateTo<HomeViewModel>(); // é»˜è®¤æ˜¾ç¤ºä¸»é¡µ
    }

    public void NavigateTo<T>() where T : ViewModelBase
    {
        // åƒä»è‡ªåŠ¨å”®è´§æœºå–è´§
        CurrentViewModel = _serviceProvider.GetRequiredService<T>();
    }
}
```

å…³é”®ç‚¹ï¼š
- ç»§æ‰¿`ObservableObject`å®ç°å±æ€§å˜æ›´é€šçŸ¥
- é€šè¿‡DIå®¹å™¨è·å–ViewModelå®ä¾‹
- çŠ¶æ€å˜æ›´è‡ªåŠ¨é€šçŸ¥ç•Œé¢

## æœ€ä½³å®è·µå»ºè®®

### 1. é¿å…ç›´æ¥æ“ä½œUI
âŒ é”™è¯¯æ–¹å¼ï¼š
```csharp
// åœ¨ViewModelä¸­ç›´æ¥æ§åˆ¶UIç»„ä»¶
mainWindow.Content = new Page2View();
```

âœ… æ­£ç¡®æ–¹å¼ï¼š
```csharp
// é€šè¿‡å¯¼èˆªæœåŠ¡é—´æ¥æ“ä½œ
_navService.NavigateTo<Page2ViewModel>();
```

### 2. å¤„ç†åˆå§‹åŒ–é€»è¾‘
å¯ä»¥åœ¨å¯¼èˆªæ—¶æ‰§è¡Œé¢å¤–æ“ä½œï¼š

```csharp
public void NavigateTo<T>() where T : ViewModelBase
{
    var page = _serviceProvider.GetRequiredService<T>();
    
    if (page is IInitializable initPage) // å¦‚æœé¡µé¢éœ€è¦åˆå§‹åŒ–
    {
        initPage.Initialize(); // è°ƒç”¨åˆå§‹åŒ–æ–¹æ³•
    }
    
    CurrentViewModel = page;
}
```

## å¸¸è§é—®é¢˜è§£ç­”

â“ å¯¼èˆªæ—¶å¦‚ä½•ä¼ é€’å‚æ•°ï¼Ÿ
å¯ä»¥æ‰©å±•æ¥å£æ·»åŠ å¸¦å‚æ•°çš„Navigateæ–¹æ³•ï¼š
```csharp
void NavigateTo<T>(object parameter) where T : ViewModelBase;
```

â“ ä¸ºä»€ä¹ˆé¡µé¢åˆ‡æ¢åæŒ‰é’®çŠ¶æ€æ²¡æ›´æ–°ï¼Ÿ
æ£€æŸ¥ViewModelæ˜¯å¦å®ç°äº†`INotifyPropertyChanged`æ¥å£

## æ€»ç»“

æœ¬ç« æˆ‘ä»¬å­¦ä¼šäº†ï¼š
- å¯¼èˆªæœåŠ¡çš„è·¯ç”±ç®¡ç†æœºåˆ¶
- å¦‚ä½•é€šè¿‡DIå®¹å™¨è·å–é¡µé¢å®ä¾‹
- MVVMæ¨¡å¼ä¸‹çš„é¡µé¢è·³è½¬æœ€ä½³å®è·µ

å°±åƒä¸ºåº”ç”¨é…å¤‡äº†ä¸“ä¸šå¯¼æ¸¸ï¼Œå¯¼èˆªæœåŠ¡è®©é¡µé¢æµè½¬å˜å¾—è½»æ¾è‡ªå¦‚ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºå„ä¸ªé¡µé¢å»ºç«‹ç»Ÿä¸€çš„"èº«ä»½è¯"â€”â€”[é¡µé¢è§†å›¾æ¨¡å‹åŸºç±»](07_é¡µé¢è§†å›¾æ¨¡å‹åŸºç±»_.md)å°†ä¸ºæ‰€æœ‰é¡µé¢æä¾›å…±åŒçš„åŸºç¡€èƒ½åŠ›ï¼

---

Generated by [AI Codebase Knowledge Builder](https://github.com/The-Pocket/Tutorial-Codebase-Knowledge)