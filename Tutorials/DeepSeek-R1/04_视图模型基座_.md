

# Chapter 4: è§†å›¾æ¨¡å‹åŸºåº§

![æ™ºèƒ½å®¶å±…æ’åº§ç»„æ’ç”»](https://via.placeholder.com/800x400.png?text=è§†å›¾æ¨¡å‹åŸºåº§ï¼šåƒç»Ÿä¸€æ’åº§ä¸ºç”µå™¨æä¾›æ ‡å‡†ä¾›ç”µæ¥å£)

åœ¨å‰å‡ ç« ä¸­æˆ‘ä»¬é…ç½®å¥½äº†[ä¾èµ–æ³¨å…¥é…ç½®ä¸­å¿ƒ](01_ä¾èµ–æ³¨å…¥é…ç½®ä¸­å¿ƒ_.md)å’Œ[åº”ç”¨å¯åŠ¨å¼•æ“](03_åº”ç”¨å¯åŠ¨å¼•æ“_.md)ï¼Œç°åœ¨éœ€è¦è®©æ‰€æœ‰è®¾å¤‡ï¼ˆViewModelï¼‰éƒ½èƒ½ã€Œé€šç”µå·¥ä½œã€ã€‚å¥½æ¯”æ™ºèƒ½å®¶å±…ä¸­çš„å„ç§ç”µå™¨éœ€è¦ä¸€ä¸ªæ ‡å‡†æ’åº§ï¼Œè§†å›¾æ¨¡å‹åŸºåº§å°±æ˜¯ä¸ºæ‰€æœ‰ViewModelæä¾›ç»Ÿä¸€æ¥å£çš„ã€Œä¸‡èƒ½æ’åº§ã€ï¼

---

## ä¸ºä»€ä¹ˆéœ€è¦åŸºåº§ï¼Ÿ  

å‡è®¾æˆ‘ä»¬è¦å¼€å‘ä¸€ä¸ªæ™ºèƒ½ç¯å…‰ç³»ç»Ÿï¼Œæ¯ä¸ªæŒ‰é’®æ§åˆ¶ä¸åŒæˆ¿é—´çš„ç…§æ˜ï¼š

```csharp
// åŸå§‹ç‰ˆæœ¬ï¼šæ²¡æœ‰ç»§æ‰¿åŸºåº§çš„ViewModel
public class LightViewModel 
{
    private bool _isOn; // ç¯å…‰çŠ¶æ€
    
    public void Toggle() 
    {
        _isOn = !_isOn;
        // éœ€è¦æ‰‹åŠ¨é€šçŸ¥ç•Œé¢æ›´æ–° ğŸ¤¯
    }
}
```

è¿™ä¼šå¯¼è‡´ï¼š
1. ğŸ”Œ æ¯ä¸ªViewModeléƒ½è¦é‡å¤å®ç°é€šçŸ¥é€»è¾‘
2. âš¡ å®¹æ˜“å¿˜è®°è§¦å‘ç•Œé¢æ›´æ–°
3. ğŸ§© ä¸åŒå¼€å‘è€…çš„å®ç°æ–¹å¼å·®å¼‚å¤§

**è§†å›¾æ¨¡å‹åŸºåº§é€šè¿‡ç»Ÿä¸€çš„åŸºç±»ï¼Œè®©æ‰€æœ‰ViewModelè‡ªå¸¦æ ‡å‡†åŒ–æ¥å£** ğŸ¯

---

## åŸºåº§ä¸‰å¤§æ ¸å¿ƒåŠŸèƒ½

### åŠŸèƒ½ä¸€ï¼šæ’ç”µå°±äº®ï¼ˆå†…ç½®é€šçŸ¥æœºåˆ¶ï¼‰
```csharp
// ä½¿ç”¨åŸºåº§åçš„ç¯å…‰ViewModel
public class LightViewModel : ViewModelBase // â† ç»§æ‰¿è‡ªåŸºåº§
{
    [ObservableProperty]
    private bool _isOn; // ç¯å…‰çŠ¶æ€
    
    // æ— éœ€æ‰‹åŠ¨é€šçŸ¥ï¼Œå°±åƒæ’ç”µå³ç”¨ï¼
}
```

é€šè¿‡ç»§æ‰¿ `ViewModelBase`ï¼Œè‡ªåŠ¨è·å¾—é€šçŸ¥UIçš„èƒ½åŠ›ã€‚å½“ `IsOn` å˜æ›´æ—¶ï¼Œç•Œé¢ä¼šè‡ªåŠ¨åˆ·æ–°ï¼

---

### åŠŸèƒ½äºŒï¼šç»Ÿä¸€æ¥å£ï¼ˆæ ‡å‡†åŒ–å±æ€§ï¼‰
```csharp
// æ‰€æœ‰ViewModeléƒ½å…·æœ‰ç›¸åŒåŸºç¡€é…ç½®
public class LightViewModel : ViewModelBase
{
    // ç»Ÿä¸€ä½¿ç”¨[ObservableProperty]ç‰¹æ€§
    [ObservableProperty]
    private string _roomName = "ä¸»å§å®¤";
}
```

è¿™å°±åƒæ‰€æœ‰å®¶ç”µçš„æ’å¤´å½¢çŠ¶ç»Ÿä¸€ä¸ºä¸¤ç›¸æ¥å£ï¼Œç¡®ä¿æ¯ä¸ªæ’åº§éƒ½èƒ½åŒ¹é…ã€‚

---

### åŠŸèƒ½ä¸‰ï¼šå³æ’å³ç”¨ï¼ˆä¾¿æ·æ‰©å±•ï¼‰
```csharp
// æ–°å¢æ¸©æ§ViewModelåªéœ€ç»§æ‰¿åŸºåº§
public class ThermoViewModel : ViewModelBase 
{
    [ObservableProperty]
    private double _temperature = 26.5;
    
    // è‡ªåŠ¨è·å¾—æ‰€æœ‰åŸºç¡€åŠŸèƒ½
}
```

æ·»åŠ æ–°çš„åŠŸèƒ½æ¨¡å—å°±åƒæ’å…¥æ–°çš„æ™ºèƒ½è®¾å¤‡ä¸€æ ·ç®€å•å¿«é€Ÿï¼

---

## å¦‚ä½•æ­å»ºåŸºåº§ï¼Ÿ

### ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºåŸºç±»æ–‡ä»¶
æ–°å»º `ViewModelBase.cs`ï¼š
```csharp
using CommunityToolkit.Mvvm.ComponentModel; // å¼•å…¥å·¥å…·åŒ…

public class ViewModelBase : ObservableObject // â† MVVMå·¥å…·ç±»
{
    // ç©ºåŸºç±»åªç»§æ‰¿åŠŸèƒ½ï¼Œåƒæ’åº§æœ¬ä½“ä¸å¸¦ç”µå™¨åŠŸèƒ½
}
```

è¿™ä¸ªç®€å•çš„åŸºç±»ç»§æ‰¿è‡ª **CommunityToolkit.Mvvm** çš„ `ObservableObject`ï¼Œå®ƒè‡ªå¸¦äº†é€šçŸ¥UIçš„åŸºç¡€èƒ½åŠ›ã€‚

---

### ç¬¬äºŒæ­¥ï¼šå¼€å‘ç”µå™¨æ¨¡å—
åˆ›å»ºå…·ä½“çš„ViewModelï¼ˆä»¥ä¸»ç•Œé¢ä¸ºä¾‹ï¼‰ï¼š
```csharp
public class MainViewModel : ViewModelBase 
{
    // ç”¨æˆ·å§“åå±æ€§ï¼ˆå¸¦è‡ªåŠ¨é€šçŸ¥ï¼‰
    [ObservableProperty]
    private string _userName = "æ–°ç”¨æˆ·";

    // æ§åˆ¶æŒ‰é’®æ˜¯å¦å¯ç”¨
    [ObservableProperty]
    private bool _isEnabled = true;
}
```

æ³¨é‡Šè¯´æ˜ï¼š
- `[ObservableProperty]` â†’ é­”æ³•æ ‡è®°ï¼Œè‡ªåŠ¨ç”Ÿæˆé€šçŸ¥ä»£ç 
- å±æ€§é¦–å­—æ¯è‡ªåŠ¨å¤§å†™ â†’ `_userName` ä¼šç”Ÿæˆ `UserName` å±æ€§

---

## åŸºåº§å·¥ä½œåŸç†å›¾è§£

```mermaid
sequenceDiagram
    participant View as ç•Œé¢å…ƒç´ 
    participant VM as ViewModel
    participant Base as åŸºåº§(ViewModelBase)
    
    VM->>Base: å±æ€§å˜æ›´é€šçŸ¥
    Base->>View: è§¦å‘ç•Œé¢åˆ·æ–°
    View->>View: æ›´æ–°æ˜¾ç¤ºå†…å®¹
```

å½“ViewModelä¸­çš„ `_userName` è¢«ä¿®æ”¹æ—¶ï¼š
1. âš¡ åŸºåº§æ£€æµ‹åˆ°å±æ€§å˜åŒ–
2. ğŸ“¡ è‡ªåŠ¨å‘å‡º `PropertyChanged` äº‹ä»¶
3. ğŸ–¥ï¸ ç•Œé¢æ¥æ”¶åˆ°äº‹ä»¶åæ›´æ–°å¯¹åº”UIå…ƒç´ 

---

## ä»£ç æ·±åº¦è§£æ

æ‰“å¼€é¡¹ç›®ä¸­çš„ `ViewModelBase.cs`ï¼š
```csharp
public class ViewModelBase : ObservableObject 
{
    // æ‰€æœ‰å…±äº«é€»è¾‘å¯åœ¨æ­¤å¤„æ·»åŠ 
    // ä¾‹å¦‚é€šç”¨çš„å¼¹çª—æœåŠ¡æˆ–å¯¼èˆªå‘½ä»¤
}
```

è™½ç„¶å½“å‰åŸºç±»æ˜¯ç©ºçš„ï¼Œä½†é€šè¿‡ç»§æ‰¿ `ObservableObject`ï¼Œå®ƒå·²ç»è·å¾—äº†ä»¥ä¸‹è¶…èƒ½åŠ›ï¼š
- ğŸ‘“ å±æ€§å˜æ›´è¿½è¸ª
- ğŸ“¢ è‡ªåŠ¨é€šçŸ¥æœºåˆ¶
- ğŸ§© å¯ä¸ä»»æ„Viewç»‘å®šçš„æ ‡å‡†åŒ–æ¥å£

---

## åŸºåº§çš„è®¾è®¡å“²å­¦

å°±åƒæ™ºèƒ½å®¶å±…çš„æ’åº§æ ‡å‡†ï¼š
1. **ç»Ÿä¸€æ€§**ï¼šæ‰€æœ‰è®¾å¤‡æ¥å£è§„èŒƒç»Ÿä¸€ï¼ˆç»§æ‰¿åŸºç±»ï¼‰  
2. **æ‰©å±•æ€§**ï¼šç”µå™¨åŠŸèƒ½è‡ªç”±æ‰©å±•ï¼ˆViewModelè‡ªå®šä¹‰å±æ€§ï¼‰  
3. **è‡ªåŠ¨åŒ–**ï¼šå³æ’å³ç”¨å…é…ç½®ï¼ˆè‡ªåŠ¨é€šçŸ¥æœºåˆ¶ï¼‰

è¿™ç§è®¾è®¡ä½¿å¾—ä¸åŒå¼€å‘è€…çš„ä»£ç èƒ½å¤Ÿæ— ç¼åä½œï¼Œå°±åƒå„ç§å“ç‰Œçš„ç”µå™¨éƒ½èƒ½ä½¿ç”¨ç›¸åŒçš„æ’åº§ã€‚

---

## æ€»ç»“ä¸æœªæ¥å±•æœ›

æˆ‘ä»¬äº†è§£äº†**è§†å›¾æ¨¡å‹åŸºåº§é€šè¿‡ç»Ÿä¸€ç»§æ‰¿ä½“ç³»å’Œè‡ªåŠ¨é€šçŸ¥æœºåˆ¶ï¼Œä¸ºViewModelå»ºç«‹äº†æ ‡å‡†åŒ–çš„å·¥ä½œæ¨¡å¼**ã€‚è¿™ä¸ºåç»­çš„[è§†å›¾è‡ªåŠ¨å®šä½å™¨](05_è§†å›¾è‡ªåŠ¨å®šä½å™¨_.md)æä¾›äº†åŸºç¡€ç»‘å®šèƒ½åŠ›ã€‚

å…³é”®æ”¶è·ï¼š
1. ğŸ§¬ ç»§æ‰¿ObservableObjectè·å¾—é€šçŸ¥èƒ½åŠ›
2. ğŸ—ï¸ æ ‡å‡†åŒ–å±æ€§å£°æ˜æ–¹å¼
3. ğŸ”Œ Viewä¸ViewModelçš„è§£è€¦è®¾è®¡

ä¸‹ä¸€ç« æˆ‘ä»¬å°†æ¢ç´¢[è§†å›¾è‡ªåŠ¨å®šä½å™¨](05_è§†å›¾è‡ªåŠ¨å®šä½å™¨_.md)ï¼Œçœ‹çœ‹å¦‚ä½•è®©åŸºåº§ä¸Šçš„ã€Œç”µå™¨ã€è‡ªåŠ¨æ‰¾åˆ°å¯¹åº”çš„ã€Œæ§åˆ¶é¢æ¿ã€ï¼ğŸš€

> æ€è€ƒé¢˜ï¼šå¦‚æœåŸºåº§è¦æ–°å¢ä¸€ä¸ªå…¨å±€çš„åŠ è½½åŠ¨ç”»çŠ¶æ€å±æ€§ï¼Œåº”è¯¥å¦‚ä½•è®¾è®¡ï¼Ÿ

---

Generated by [AI Codebase Knowledge Builder](https://github.com/The-Pocket/Tutorial-Codebase-Knowledge)