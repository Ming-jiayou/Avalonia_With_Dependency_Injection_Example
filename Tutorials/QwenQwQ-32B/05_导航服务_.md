# Chapter 5: å¯¼èˆªæœåŠ¡

åœ¨ä¸Šä¸€ç« æˆ‘ä»¬äº†è§£äº†[é¡µé¢å†…å®¹æ§ä»¶](04_é¡µé¢å†…å®¹æ§ä»¶_.md)å¦‚ä½•åƒé­”æ³•ç”»æ¡†ä¸€æ ·å±•ç¤ºä¸åŒå†…å®¹ï¼Œç°åœ¨è®©æˆ‘ä»¬è®¤è¯†èƒŒåçš„"GPSç³»ç»Ÿ"â€”â€”å¯¼èˆªæœåŠ¡ï¼Œå®ƒå°†æˆä¸ºä½ åœ¨åº”ç”¨é¡µé¢é—´ç©¿æ¢­çš„æ™ºèƒ½å‘å¯¼ï¼

## ä¸ºä»€ä¹ˆéœ€è¦å¯¼èˆªæœåŠ¡ï¼Ÿ

æƒ³è±¡ä½ åœ¨é©¾é©¶ä¸€è¾†æ±½è½¦ ğŸš—ï¼š

- **æ²¡æœ‰å¯¼èˆª**ï¼šä½ éœ€è¦è®°è·¯æ ‡ã€æŸ¥åœ°å›¾ï¼Œæ‰‹å¿™è„šä¹±
- **ä½¿ç”¨å¯¼èˆª**ï¼šåªéœ€å‘Šè¯‰å®ƒç›®çš„åœ°ï¼Œå°±ä¼šè‡ªåŠ¨è§„åˆ’è·¯çº¿

å¯¼èˆªæœåŠ¡å°±æ˜¯åº”ç”¨ç¨‹åºä¸­çš„è¿™ä¸ª"æ™ºèƒ½å¯¼èˆªç³»ç»Ÿ"ï¼Œå®ƒèƒ½ï¼š
1. è®°ä½å½“å‰æ‰€åœ¨é¡µé¢ï¼ˆå½“å‰ä½ç½®ï¼‰
2. æ¥æ”¶ç›®æ ‡é¡µé¢æŒ‡ä»¤ï¼ˆç›®çš„åœ°ï¼‰
3. è‡ªåŠ¨å®Œæˆé¡µé¢åˆ‡æ¢ï¼ˆè§„åˆ’è·¯çº¿ï¼‰

## æ ¸å¿ƒåŠŸèƒ½è§£æ

### 1. å½“å‰é¡µé¢è®°å½•
å°±åƒGPSä¼šæ˜¾ç¤º"å½“å‰åœ¨XXè·¯"ï¼š
```csharp
[ObservableProperty]
private ViewModelBase _currentViewModel; // è·Ÿè¸ªå½“å‰æ˜¾ç¤ºçš„ViewModel
```

> ğŸ’¡ æŠ€æœ¯ç‚¹ï¼š`[ObservableProperty]`ä¼šè®©å±æ€§å˜æ›´è‡ªåŠ¨é€šçŸ¥UIæ›´æ–°

### 2. é¡µé¢åˆ‡æ¢åŠŸèƒ½
è°ƒç”¨å¯¼èˆªå°±åƒå¯¹å‡ºç§Ÿè½¦å¸æœºè¯´"å»æœºåœº"ï¼š
```csharp
public void NavigateTo<T>() where T : ViewModelBase
{
    var viewModel = _serviceProvider.GetRequiredService<T>(); // è·å–ç›®æ ‡VM
    CurrentViewModel = viewModel; // æ›´æ–°å½“å‰é¡µ
}
```

### 3. ä¾èµ–æ³¨å…¥é›†æˆ
é€šè¿‡æ„é€ å‡½æ•°è·å–æœåŠ¡å®¹å™¨ï¼š
```csharp
public NavigationService(IServiceProvider serviceProvider)
{
    _serviceProvider = serviceProvider;
    NavigateTo<Page1ViewModel>(); // é»˜è®¤æ˜¾ç¤ºé¦–é¡µ
}
```

## å·¥ä½œåŸç†å›¾è§£

å½“è°ƒç”¨`NavigateTo`æ—¶çš„å†…éƒ¨æµç¨‹ï¼š

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·ç•Œé¢
    participant NS as å¯¼èˆªæœåŠ¡
    participant DI as ä¾èµ–å®¹å™¨
    participant VM as æ–°ViewModel

    U->>NS: è¯·æ±‚è·³è½¬åˆ°Page2
    NS->>DI: è·å–Page2ViewModelå®ä¾‹
    DI-->>NS: è¿”å›å®ä¾‹
    NS->>VM: è®¾ç½®ä¸ºCurrentViewModel
    NS-->>U: è§¦å‘ç•Œé¢æ›´æ–°
```

## å®æˆ˜æ¼”ç»ƒ

### 1. åŸºæœ¬ä½¿ç”¨
ä»ä¸»çª—å£ViewModelè°ƒç”¨å¯¼èˆªï¼š
```csharp
[RelayCommand]
private void GoToSettings()
{
    _navigationService.NavigateTo<SettingsViewModel>();
}
```

### 2. å¸¦å‚æ•°å¯¼èˆª
å¦‚æœéœ€è¦ä¼ é€’å‚æ•°ï¼ˆè¿›é˜¶ç”¨æ³•ï¼‰ï¼š
```csharp
// åœ¨å¯¼èˆªæœåŠ¡ä¸­æ·»åŠ æ–¹æ³•
public void NavigateWithData<T>(object data) where T : ViewModelBase
{
    var vm = _serviceProvider.GetRequiredService<T>();
    if (vm is IRecipient recipient) 
    {
        recipient.ReceiveData(data); // å‡è®¾ViewModelå®ç°äº†æ•°æ®æ¥æ”¶æ¥å£
    }
    CurrentViewModel = vm;
}
```

## ä¸ä¼ ç»Ÿæ–¹å¼å¯¹æ¯”

**æ—§æ–¹å¼**ï¼šç›´æ¥åˆ›å»ºé¡µé¢å®ä¾‹
```csharp
// é—®é¢˜ï¼šç´§è€¦åˆã€éš¾æµ‹è¯•ã€çŠ¶æ€æ˜“ä¸¢å¤±
MainFrame.Content = new Page2();
```

**ç°ä»£æ–¹å¼**ï¼šé€šè¿‡å¯¼èˆªæœåŠ¡
```csharp
// ä¼˜ç‚¹ï¼šæ¾è€¦åˆã€æ˜“æµ‹è¯•ã€çŠ¶æ€é›†ä¸­ç®¡ç†
_navigationService.NavigateTo<Page2ViewModel>();
```

## å¸¸è§é—®é¢˜è§£ç­”

**Q**ï¼šé¡µé¢åˆ‡æ¢æ²¡ååº”æ€ä¹ˆåŠï¼Ÿ  
âœ… æ£€æŸ¥æ­¥éª¤ï¼š
1. ç¡®è®¤ViewModelå·²æ³¨å†Œåˆ°ä¾èµ–å®¹å™¨
2. æ£€æŸ¥`CurrentViewModel`æ˜¯å¦å®ç°äº†`INotifyPropertyChanged`
3. ç¡®ä¿[ä¸»çª—å£è§†å›¾æ¨¡å‹](03_ä¸»çª—å£è§†å›¾æ¨¡å‹_.md)æ­£ç¡®è®¢é˜…äº†å˜æ›´äº‹ä»¶

**Q**ï¼šå¦‚ä½•åœ¨é¡µé¢é—´ä¼ é€’æ•°æ®ï¼Ÿ  
æ–¹æ¡ˆ1ï¼šé€šè¿‡å…±äº«æœåŠ¡ï¼ˆæ¨èï¼‰  
æ–¹æ¡ˆ2ï¼šæ‰©å±•å¯¼èˆªæœåŠ¡æ”¯æŒå‚æ•°ï¼ˆå¦‚ä¸Šæ–‡ç¤ºä¾‹ï¼‰

## æ€»ç»“ä¸å±•æœ›

ä»Šå¤©æˆ‘ä»¬æŒæ¡äº†ï¼š
- å¯¼èˆªæœåŠ¡çš„GPSå¼å·¥ä½œåŸç† ğŸ—ºï¸
- é¡µé¢è·³è½¬çš„ç°ä»£åŒ–å®ç° ğŸš€
- ä¾èµ–æ³¨å…¥çš„å®Œç¾é…åˆ âš™ï¸
- å¸¸è§é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ ğŸ› ï¸

æ¥ä¸‹æ¥æˆ‘ä»¬å°†å­¦ä¹ [é¡µé¢è§†å›¾æ¨¡å‹åŸºç±»](06_é¡µé¢è§†å›¾æ¨¡å‹åŸºç±»_.md)ï¼Œå®ƒæ˜¯æ‰€æœ‰é¡µé¢çš„"åŸºå› è“å›¾"ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•æ‰“é€ æ ‡å‡†åŒ–çš„é¡µé¢ç»“æ„ï¼

---

Generated by [AI Codebase Knowledge Builder](https://github.com/The-Pocket/Tutorial-Codebase-Knowledge)