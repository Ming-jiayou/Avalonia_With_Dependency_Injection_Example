# Chapter 7: è§†å›¾å®šä½å™¨

åœ¨ä¸Šä¸€ç« å­¦ä¹ äº†[é¡µé¢è§†å›¾æ¨¡å‹åŸºç±»](06_é¡µé¢è§†å›¾æ¨¡å‹åŸºç±»_.md)åï¼Œæˆ‘ä»¬çŸ¥é“å¦‚ä½•æ„å»ºæ ‡å‡†çš„é¡µé¢é€»è¾‘ã€‚ç°åœ¨æˆ‘ä»¬æ¥è®¤è¯†ä¸€ä½ç¥å¥‡çš„"çº¢å¨˜"â€”â€”è§†å›¾å®šä½å™¨ï¼Œå®ƒèƒ½è‡ªåŠ¨ä¸ºViewModelæ‰¾åˆ°é…å¯¹Viewï¼Œå°±åƒç›¸äº²è½¯ä»¶èƒ½å¸®ä½ åŒ¹é…æœ€åˆé€‚çš„å¯¹è±¡ï¼ğŸ‘©ğŸ’¼ğŸ‘¨ğŸ’¼

## ä¸ºä»€ä¹ˆéœ€è¦è§†å›¾å®šä½å™¨ï¼Ÿ

å‡è®¾ä½ ä¸¾åŠä¸€åœºé«˜ç«¯æ™šå®´ ğŸ½ï¸ï¼š

- **ä¼ ç»Ÿæ–¹å¼**ï¼šéœ€è¦äººå·¥æ ¸å¯¹å®¾å®¢åå•å’Œåº§ä½è¡¨
- **ç°ä»£æ–¹å¼**ï¼šä½¿ç”¨ç”µå­å¼•å¯¼ç³»ç»Ÿï¼Œè‡ªåŠ¨æ˜¾ç¤ºæ¥å®¾å¯¹åº”çš„åº§ä½

```mermaid
flowchart LR
    A[å®¾å®¢åå•] -->|è‡ªåŠ¨åŒ¹é…| B[åº§ä½è¡¨]
```

è§†å›¾å®šä½å™¨å°±æ˜¯åº”ç”¨ç¨‹åºä¸­çš„ç”µå­å¼•å¯¼ç³»ç»Ÿï¼Œå®ƒè‡ªåŠ¨å®Œæˆï¼š
1. æ ¹æ®ViewModelç±»å‹æ‰¾åˆ°å¯¹åº”Viewç±»å‹
2. åˆ›å»ºæˆ–è·å–Viewå®ä¾‹
3. å»ºç«‹ä¸¤è€…å…³è”å…³ç³»

## æ ¸å¿ƒç†å¿µï¼šå‘½åçº¦å®š

å°±åƒé…’åº—æ ¹æ®"æˆ¿å·+å§“å"æ¥åˆ†é…æˆ¿é—´ï¼š

```csharp
// Viewå¯»æ‰¾è§„åˆ™ç¤ºä¾‹ï¼š
LoginViewModel â†’ LoginView
SettingsViewModel â†’ SettingsView
```

> ğŸ’¡ è§„å¾‹ï¼šæŠŠ"ViewModel"æ›¿æ¢ä¸º"View"å³å¯æ‰¾åˆ°å¯¹åº”è§†å›¾

## åŸºç¡€ä½¿ç”¨æ–¹å¼

### 1. æ³¨å†Œè§†å›¾å®šä½å™¨
åœ¨`App.axaml.cs`ä¸­é…ç½®ï¼š

```csharp
public override void Initialize()
{
    AvaloniaXamlLoader.Load(this);
    DataTemplates.Add(new ViewLocator()); // æ·»åŠ è‡ªåŠ¨åŒ¹é…è§„åˆ™
}
```

### 2. è‡ªåŠ¨ç»‘å®šç¤ºä¾‹
å½“è®¾ç½®`ContentControl`çš„`Content`å±æ€§æ—¶ï¼š

```xml
<ContentControl Content="{Binding CurrentViewModel}"/>
```

ä¼šè‡ªåŠ¨è§¦å‘è§†å›¾å®šä½å™¨ä¸ºå½“å‰ViewModelæ‰¾åˆ°å¯¹åº”Viewï¼

## å·¥ä½œåŸç†å›¾è§£

è§†å›¾å®šä½å™¨çš„åŒ¹é…æµç¨‹ï¼š

```mermaid
sequenceDiagram
    participant VMC as ViewModel
    participant VL as è§†å›¾å®šä½å™¨
    participant V as View
    
    VMC->>VL: æˆ‘æ˜¯LoginViewModel
    VL->>VL: è½¬æ¢ç±»å‹åâ†’LoginView
    VL->>V: åˆ›å»º/è·å–LoginViewå®ä¾‹
    VL-->>ContentControl: è¿”å›è§†å›¾å¯¹è±¡
```

## ä¸¤ç§å®ç°æ–¹å¼å¯¹æ¯”

### 1. ç®€å•å®ç°ï¼ˆæ— ä¾èµ–æ³¨å…¥ï¼‰
```csharp
public Control? Build(object? param)
{
    var viewName = param.GetType().FullName!.Replace("ViewModel", "View");
    var viewType = Type.GetType(viewName);
    return (Control)Activator.CreateInstance(viewType)!; // ç›´æ¥åˆ›å»ºå®ä¾‹
}
```

### 2. ä¾èµ–æ³¨å…¥ç‰ˆæœ¬ï¼ˆæ¨èï¼‰
```csharp
public Control? Build(object? param)
{
    var viewName = param.GetType().FullName!.Replace("ViewModel", "View");
    var viewType = Type.GetType(viewName);
    
    // ä¼˜å…ˆä»å®¹å™¨è·å–
    var view = ServiceProvider.GetService(viewType) as Control;
    return view ?? Activator.CreateInstance(viewType) as Control; // å®¹å™¨æ— åˆ™æ–°å»º
}
```

> ğŸŒŸ ä¼˜åŠ¿ï¼šèƒ½ä¸[ä¾èµ–æ³¨å…¥å®¹å™¨](02_ä¾èµ–æ³¨å…¥å®¹å™¨_.md)æ— ç¼é›†æˆ

## å®æˆ˜æŠ€å·§

### 1. è‡ªå®šä¹‰å‘½åè§„åˆ™
å¦‚æœéœ€è¦ç‰¹æ®Šå‘½åè§„åˆ™ï¼š

```csharp
var viewName = "SpecialPrefix." + param.GetType().Name.Replace("VM", "View");
```

### 2. è§†å›¾é¢„çƒ­
æå‰æ³¨å†Œå¸¸ç”¨è§†å›¾åˆ°å®¹å™¨ï¼š

```csharp
services.AddSingleton<LoginView>();
services.AddTransient<SettingsView>();
```

## å¸¸è§é—®é¢˜è§£ç­”

**Q**ï¼šä¸ºä»€ä¹ˆæ˜¾ç¤º"Not Found"è€Œä¸æ˜¯è§†å›¾ï¼Ÿ  
âœ… æ£€æŸ¥æ­¥éª¤ï¼š
1. ç¡®è®¤ViewModelå’ŒViewå‘½åç¬¦åˆçº¦å®š
2. æ£€æŸ¥Viewç±»æ˜¯å¦åœ¨æ­£ç¡®å‘½åç©ºé—´
3. ç¡®ä¿è§†å›¾å®šä½å™¨å·²æ³¨å†Œåˆ°`DataTemplates`

**Q**ï¼šå¦‚ä½•è°ƒè¯•åŒ¹é…è¿‡ç¨‹ï¼Ÿ  
âœ… è§£å†³æ–¹æ¡ˆï¼šåœ¨`Build`æ–¹æ³•ä¸­æ·»åŠ æ—¥å¿—ï¼š

```csharp
Console.WriteLine($"å°è¯•åŒ¹é…ï¼š{param.GetType()} â†’ {viewName}");
```

## æ€»ç»“ä¸å±•æœ›

ä»Šå¤©æˆ‘ä»¬æŒæ¡äº†ï¼š
- è§†å›¾å®šä½å™¨çš„çº¢å¨˜å¼åŒ¹é…æœºåˆ¶ ğŸ’•
- å‘½åçº¦å®šçš„è‡ªåŠ¨åŒ–è§„åˆ™ ğŸ“
- ä¾èµ–æ³¨å…¥çš„ä¼˜é›…é›†æˆ âš¡
- æ•…éšœæ’æŸ¥çš„æŠ€å·§æŒ‡å— ğŸ› ï¸

æ¥ä¸‹æ¥æˆ‘ä»¬å°†æ¢ç´¢[ä¸»é¢˜ç®¡ç†ç³»ç»Ÿ](08_ä¸»é¢˜ç®¡ç†ç³»ç»Ÿ_.md)ï¼Œä¸ºåº”ç”¨ç¨‹åºæ¢ä¸Šç¾ä¸½çš„"çš®è‚¤"ï¼Œè®©ç•Œé¢ç„•ç„¶ä¸€æ–°ï¼

---

Generated by [AI Codebase Knowledge Builder](https://github.com/The-Pocket/Tutorial-Codebase-Knowledge)