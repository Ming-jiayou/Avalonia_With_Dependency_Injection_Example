# Chapter 3: ä¸»çª—å£è§†å›¾æ¨¡å‹

æ¬¢è¿å›åˆ°æˆ‘ä»¬çš„Avaloniaä¹‹æ—…ï¼åœ¨ä¸Šä¸€ç« æˆ‘ä»¬è®¤è¯†äº†é­”æ³•å·¥å…·ç®±â€”â€”[ä¾èµ–æ³¨å…¥å®¹å™¨](02_ä¾èµ–æ³¨å…¥å®¹å™¨_.md)ï¼Œç°åœ¨è®©æˆ‘ä»¬æ¥è®¤è¯†åº”ç”¨ä¸­çš„"äº¤é€šæŒ‡æŒ¥å®˜"ï¼šä¸»çª—å£è§†å›¾æ¨¡å‹ï¼

## ä¸ºä»€ä¹ˆéœ€è¦ä¸»çª—å£è§†å›¾æ¨¡å‹ï¼Ÿ

æƒ³è±¡ä½ æ­£åœ¨çœ‹ä¸€åœºéŸ³ä¹ä¼š ğŸµï¼š

- **è§‚ä¼—è§†è§’**ï¼šæ¬£èµä¸»èˆå°ä¸æ–­å˜åŒ–çš„ç²¾å½©è¡¨æ¼”
- **åå°è§†è§’**ï¼šèˆå°æ€»ç›‘åœ¨å¹•ååè°ƒæ¼”å‘˜ä¸Šä¸‹åœº

```mermaid
flowchart LR
    A[è§‚ä¼—] -->|è§‚çœ‹| B(å½“å‰é¡µé¢)
    C[èˆå°æ€»ç›‘] -->|è°ƒåº¦| B
```

ä¸»çª—å£è§†å›¾æ¨¡å‹å°±æ˜¯é‚£ä½"èˆå°æ€»ç›‘"ï¼Œå®ƒéœ€è¦ï¼š
1. è·Ÿè¸ªå½“å‰æ˜¾ç¤ºçš„é¡µé¢ï¼ˆä¸»èˆå°ï¼‰
2. å¤„ç†å¯¼èˆªæŒ‰é’®ç‚¹å‡»ï¼ˆæ¼”å‘˜è°ƒåº¦æŒ‡ä»¤ï¼‰
3. ç¡®ä¿é¡µé¢åˆ‡æ¢æµç•…ï¼ˆæ— ç¼è½¬åœºï¼‰

## æ ¸å¿ƒåŠŸèƒ½æ‹†è§£

### 1. å½“å‰é¡µé¢ç®¡ç†
å°±åƒç”µè§†é¥æ§å™¨çš„"å½“å‰é¢‘é“"æ˜¾ç¤ºï¼š
```csharp
[ObservableProperty] 
private ViewModelBase currentPage; // å½“å‰æ˜¾ç¤ºçš„é¡µé¢VM
```

> ğŸ’¡ æ³¨è§£ï¼š`[ObservableProperty]`ä¼šè‡ªåŠ¨ç”Ÿæˆå±æ€§å˜æ›´é€šçŸ¥ï¼Œç•Œé¢ä¼šå®æ—¶æ›´æ–°

### 2. å¯¼èˆªæœåŠ¡ååŒ
é€šè¿‡[ä¾èµ–æ³¨å…¥å®¹å™¨](02_ä¾èµ–æ³¨å…¥å®¹å™¨_.md)è·å–å¯¼èˆªæœåŠ¡ï¼š
```csharp
private readonly INavigationService _navigationService;

public MainWindowViewModel(INavigationService navigationService)
{
    _navigationService = navigationService;
    CurrentPage = _navigationService.CurrentViewModel; // åˆå§‹åŒ–å½“å‰é¡µ
}
```

### 3. å¯¼èˆªå“åº”
å¤„ç†æŒ‰é’®ç‚¹å‡»çš„å¯¼èˆªæŒ‡ä»¤ï¼š
```csharp
[RelayCommand]
private void NavigateToPage1()
{
    _navigationService.NavigateTo<Page1ViewModel>(); // åˆ‡æ¢åˆ°é¡µé¢1
}
```

> ğŸ¯ å°çŸ¥è¯†ï¼š`[RelayCommand]`ä¼šå°†æ–¹æ³•è‡ªåŠ¨è½¬æ¢ä¸ºå¯ç»‘å®šå‘½ä»¤

## ä¼ ç»Ÿæ–¹å¼ vs ç°ä»£æ–¹å¼

ä¸¤æ®µä»£ç å¯¹æ¯”å±•ç¤ºè¿›åŒ–ï¼š

```csharp
// ä¼ ç»Ÿæ–¹å¼ï¼šç›´æ¥åˆ›å»ºæ–°å®ä¾‹
CurrentPage = new Page1ViewModel(); 
```
- âŒ ç´§è€¦åˆ
- âŒ éš¾ä»¥æµ‹è¯•
- âŒ æ— æ³•å…±äº«çŠ¶æ€

```csharp
// ç°ä»£æ–¹å¼ï¼šé€šè¿‡å¯¼èˆªæœåŠ¡
_navigationService.NavigateTo<Page1ViewModel>();
```
- âœ… è§£è€¦
- âœ… å¯æµ‹è¯•
- âœ… çŠ¶æ€ç»´æŠ¤

## å†…éƒ¨å·¥ä½œæœºåˆ¶

å½“ç‚¹å‡»å¯¼èˆªæŒ‰é’®æ—¶ï¼š

```mermaid
sequenceDiagram
    participant B as æŒ‰é’®
    participant M as MainWindowVM
    participant N as å¯¼èˆªæœåŠ¡
    participant P as æ–°é¡µé¢
    
    B->>M: ç‚¹å‡»NavigateToPage1
    M->>N: NavigateTo<Page1VM>
    N->>P: åˆ›å»º/è·å–Page1å®ä¾‹
    N-->>M: æ›´æ–°CurrentViewModel
    M->>ç•Œé¢: é€šçŸ¥CurrentPageå˜æ›´
```

## å®æˆ˜æŠ€å·§ï¼šå±æ€§å˜æ›´è®¢é˜…

ç¡®ä¿èƒ½å®æ—¶å“åº”å¯¼èˆªæœåŠ¡çš„å˜åŒ–ï¼š
```csharp
// åœ¨æ„é€ å‡½æ•°ä¸­æ·»åŠ ï¼š
((NavigationService)_navigationService).PropertyChanged += (_, args) =>
{
    if (args.PropertyName == nameof(INavigationService.CurrentViewModel))
    {
        CurrentPage = _navigationService.CurrentViewModel; // åŒæ­¥æ›´æ–°
    }
};
```

> ğŸ” å·¥ä½œåŸç†ï¼šå½“å¯¼èˆªæœåŠ¡çš„CurrentViewModelå˜åŒ–æ—¶ï¼Œè‡ªåŠ¨æ›´æ–°æœ¬åœ°CurrentPage

## æ€»ç»“ä¸é¢„å‘Š

ä»Šå¤©æˆ‘ä»¬å­¦åˆ°äº†ï¼š
- ä¸»çª—å£VMçš„æŒ‡æŒ¥å®˜è§’è‰² ğŸ–ï¸
- å¦‚ä½•ç®¡ç†å½“å‰é¡µé¢çŠ¶æ€ ğŸ–¼ï¸
- å¯¼èˆªå‘½ä»¤çš„ä¼˜é›…å®ç° ğŸ§­
- å±æ€§å˜æ›´çš„è”åŠ¨æŠ€å·§ â›“ï¸

æ¥ä¸‹æ¥è¦æ¢ç´¢çš„æ˜¯ï¼š[é¡µé¢å†…å®¹æ§ä»¶](04_é¡µé¢å†…å®¹æ§ä»¶_.md)â€”â€”å®ƒå°±åƒèˆå°ä¸Šçš„å¯æ›¿æ¢èƒŒæ™¯æ¿ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•çµæ´»åˆ‡æ¢å„ç§å†…å®¹è§†å›¾ï¼

---

Generated by [AI Codebase Knowledge Builder](https://github.com/The-Pocket/Tutorial-Codebase-Knowledge)